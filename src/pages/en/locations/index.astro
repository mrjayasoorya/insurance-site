---
import DesktopHero from "../../../components/DesktopHero.astro";
import MobileHero from "../../../components/MobileHero.astro";
import FooterCtaBar from "../../../components/FooterCtaBar.astro";
import FloatingContactCta from "../../../components/FloatingContactCta.astro";
import FloatingMenu from "../../../components/FloatingMenu.astro";
import LocalIdentitySection from "../../../components/LocalIdentitySection.astro";
import BacklinksRow from "../../../components/BacklinksRow.astro";

import { siteData, EN } from "../../../content/siteData";
import NearMeTrustSection from "src/components/NearMeTrustSection.astro";
import { buildJsonLd, buildMeta, canonicalFromPath } from "src/lib/seo";

const canonical = canonicalFromPath(siteData.brand.websiteUrl, "/en/locations/");
const meta = buildMeta({
  title: `Locations | ${siteData.brand.name}`,
  description: siteData.locationsIndex.subtitle,
  canonical,
  ogType: "website",
});

const jsonLd = buildJsonLd({
  pageType: "locationsIndex",
  siteData,
  canonical,
  title: meta.title,
  description: meta.description,
  breadcrumbs: [
    { name: "Home", href: canonicalFromPath(siteData.brand.websiteUrl, "/en/") },
    { name: "Locations", href: canonical },
  ],
  extraNodes: [
    {
      "@type": "CollectionPage",
      "@id": `${canonical}#collection`,
      url: canonical,
      name: siteData.locationsIndex.title,
      description: siteData.locationsIndex.subtitle,
    },
  ],
});
---

<html lang="en">
  <head>

    <title>{meta.title}</title>
  <meta name="description" content={meta.description} />
  <link rel="canonical" href={meta.canonical} />
  {Object.entries(meta.tags).map(([k,v]) => <meta property={k} content={v} />)}
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />
    <meta name="googlebot" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />
    <link rel="stylesheet" href="/styles/theme.css" />
  </head>

  <body>
    <main class="app">
      <div class="container">

        <!-- DESKTOP -->
        <div class="ui-desktop">
          <header>
            <DesktopHero
              brand={{
                name: siteData.brand.name,
                tagline: siteData.brand.tagline,
                subtitle: siteData.locationsIndex.subtitle,
                phone: siteData.brand.phone,
                areaChips: siteData.brand.areaChips,
              }}
            />
          </header>

          <section class="section section-padding" aria-labelledby="loc-title">
            <h1 id="loc-title" class="section-title">{siteData.locationsIndex.title}</h1>
            <p class="section-sub readable">{siteData.locationsIndex.subtitle}</p>
            <ul class="bullets">
              {siteData.locationsIndex.intro.map((p) => <li>{p}</li>)}
            </ul>
          </section>

          <section class="section section-padding" aria-labelledby="loc-principles">
            <h2 id="loc-principles" class="section-title">{siteData.locationsIndex.claimReadyPrinciples.title}</h2>
            <ul class="bullets">
              {siteData.locationsIndex.claimReadyPrinciples.points.map((p) => <li>{p}</li>)}
            </ul>
          </section>

          {siteData.locationsIndex.groups.map((g) => (
            <section class="section section-padding" aria-labelledby={g.id}>
              <h2 id={g.id} class="section-title">{g.title}</h2>
              <p class="section-sub readable">{g.subtitle}</p>

              <ul class="loc-rows" role="list" aria-label={`${g.title} locations`}>
                {(g.locations || []).map((x) => (
                  <li class="loc-row">
                    <a class="loc-link" href={EN(`/locations/${x.slug}/`)}>
                      <span class="loc-name">{x.name}</span>
                      <span class="loc-meta">Open local service guide</span>
                    </a>
                  </li>
                ))}
              </ul>
            </section>
          ))}

          <LocalIdentitySection brand={siteData.brand} pageTitle="Locations" />
          <NearMeTrustSection data={{nearMeIntent: siteData.nearMeIntent, trustValidation: siteData.trustValidation}} />
          <BacklinksRow title={siteData.backlinks.title} links={siteData.backlinks.links} />

          <FooterCtaBar
            title={siteData.footerCtas.title}
            subtitle={siteData.footerCtas.subtitle}
            whatsappNumber={siteData.brand.whatsappE164}
            whatsappText={siteData.brand.whatsappPrefill}
            callNumber={siteData.brand.phoneE164}
            callLabel={siteData.footerCtas.callLabel}
            brandName={siteData.footerCtas.brandName}
            logoText={siteData.footerCtas.logoText}
            copyright={siteData.footerCtas.copyright}
          />
        </div>

        <!-- MOBILE -->
        <div class="ui-mobile">
          <header>
            <MobileHero
              brand={{
                name: siteData.brand.name,
                tagline: siteData.brand.tagline,
                subtitle: siteData.locationsIndex.subtitle,
                phone: siteData.brand.phone,
                areaChips: [],
              }}
            />
          </header>

          <section class="section section-padding">
            <h1 class="section-title">{siteData.locationsIndex.title}</h1>
            <p class="section-sub readable">{siteData.locationsIndex.subtitle}</p>
            <ul class="bullets">
              {siteData.locationsIndex.intro.map((p) => <li>{p}</li>)}
            </ul>
          </section>

          {siteData.locationsIndex.groups.map((g) => (
            <section class="section section-padding" aria-labelledby={`m-${g.id}`}>
              <h2 id={`m-${g.id}`} class="section-title">{g.title}</h2>
              <p class="section-sub readable">{g.subtitle}</p>

              <ul class="loc-rows" role="list">
                {(g.locations || []).map((x) => (
                  <li class="loc-row">
                    <a class="loc-link" href={EN(`/locations/${x.slug}/`)}>
                      <span class="loc-name">{x.name}</span>
                      <span class="loc-meta">Open</span>
                    </a>
                  </li>
                ))}
              </ul>
            </section>
          ))}

          <LocalIdentitySection brand={siteData.brand} pageTitle="Locations" />
          <NearMeTrustSection data={{nearMeIntent: siteData.nearMeIntent, trustValidation: siteData.trustValidation}} />
          <BacklinksRow title={siteData.backlinks.title} links={siteData.backlinks.links} />

          <FooterCtaBar
            title={siteData.footerCtas.title}
            subtitle={siteData.footerCtas.subtitle}
            whatsappNumber={siteData.brand.whatsappE164}
            whatsappText={siteData.brand.whatsappPrefill}
            callNumber={siteData.brand.phoneE164}
            callLabel={siteData.footerCtas.callLabel}
            brandName={siteData.footerCtas.brandName}
            logoText={siteData.footerCtas.logoText}
            copyright={siteData.footerCtas.copyright}
          />
        </div>
      </div>
    </main>

    <FloatingMenu brand={siteData.brand} />
    <FloatingContactCta brand={siteData.brand} />
  </body>
</html>

<style is:global>
  .loc-rows{
    margin: 14px 0 0;
    padding: 0;
    list-style: none;
    display:flex;
    flex-direction:column;
    gap: 10px;
  }
  .loc-row{
    border: 1px solid var(--border);
    border-radius: 16px;
    background: var(--surface);
    box-shadow: 0 2px 10px rgba(11,13,18,.05);
  }
  .loc-link{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 12px;
    padding: 12px 14px;
  }
  .loc-name{
    font-weight: 950;
    letter-spacing: -0.01em;
    font-size: 14px;
  }
  .loc-meta{
    color: var(--muted);
    font-size: 12.5px;
    white-space: nowrap;
  }
</style>
