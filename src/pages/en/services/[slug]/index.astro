---
import DesktopHero from "../../../../components/DesktopHero.astro";
import MobileHero from "../../../../components/MobileHero.astro";
import MobileAccordion from "../../../../components/MobileAccordion.astro";
import FooterCtaBar from "../../../../components/FooterCtaBar.astro";
import CoverageIndexSection from "../../../../components/CoverageIndexSection.astro";
import FloatingContactCta from "src/components/FloatingContactCta.astro";

import { siteData } from "../../../../content/siteData";

export async function getStaticPaths() {
  const all = siteData?.servicesDetail || {};
  return Object.keys(all).map((slug) => ({ params: { slug } }));
}

const { slug } = Astro.params;

const service = siteData.servicesDetail?.[slug];
if (!service) {
  throw new Error(`Unknown service slug: ${slug}`);
}

const canonicalBase = siteData.brand.websiteUrl || "https://rajendrakumarinsurance.in";
const canonical = `${canonicalBase.replace(/\/$/, "")}/en/services/${slug}/`;

const jsonLd = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Service",
      name: service.heroH1,
      description: service.heroP,
      areaServed: siteData.brand.areaChips,
      provider: {
        "@type": "Organization",
        name: siteData.brand.name,
        telephone: siteData.brand.phoneE164,
        sameAs: [siteData.brand.gbpUrl].filter(Boolean),
      },
      url: canonical,
    },
    ...(service.faqs?.length
      ? [
          {
            "@type": "FAQPage",
            mainEntity: service.faqs.map((f) => ({
              "@type": "Question",
              name: f.q,
              acceptedAnswer: { "@type": "Answer", text: f.a },
            })),
          },
        ]
      : []),
  ],
};
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{service.seoTitle} | {siteData.brand.name}</title>
    <meta name="description" content={service.seoDesc} />
    <link rel="canonical" href={canonical} />
    <link rel="stylesheet" href="/styles/theme.css" />
    <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  </head>

  <body>
    <main class="app">
      <div class="container">
        <div class="ui-desktop">
          <header>
            <DesktopHero
              brand={{
                name: siteData.brand.name,
                tagline: siteData.brand.tagline,
                subtitle: service.heroP,
                phone: siteData.brand.phone,
                areaChips: siteData.brand.areaChips,
              }}
            />
          </header>

          <section class="section section-padding">
            <h1 class="section-title">{service.heroH1}</h1>
            <p class="section-sub">{service.heroP}</p>
          </section>

          <section class="section section-padding" aria-label="Who this is for">
            <h2 class="section-title">Who this is for</h2>
            <ul class="bullets">
              {service.whoFor?.map((x) => <li>{x}</li>)}
            </ul>
          </section>

          <section class="section section-padding" aria-label="Local fit">
            <h2 class="section-title">Local context (Sholavaram + NH + industrial belts)</h2>
            <p class="readable">{service.localFit}</p>
          </section>

          <section class="section section-padding" aria-label="What we focus on">
            <h2 class="section-title">What we focus on (claim-first)</h2>
            <ul class="bullets">
              {service.keyCoverFocus?.map((x) => <li>{x}</li>)}
            </ul>
          </section>

          <section class="section section-padding" aria-label="Claim documents checklist">
            <h2 class="section-title">Claim-ready documents (keep this discipline)</h2>
            <ul class="bullets">
              {service.claimDocs?.map((x) => <li>{x}</li>)}
            </ul>
          </section>

          <section class="section section-padding" aria-label="Common mistakes">
            <h2 class="section-title">Common mistakes we prevent</h2>
            <ul class="bullets">
              {service.commonMistakes?.map((x) => <li>{x}</li>)}
            </ul>
          </section>

          <section class="section section-padding" aria-label="Local search signals">
            <h2 class="section-title">Local service signals (for crawl clarity)</h2>
            <p class="muted readable">
              {service.areaSignals?.join(" â€¢ ")}
            </p>
          </section>

          {service.faqs?.length ? (
            <section class="section section-padding" aria-label="FAQs">
              <h2 class="section-title">FAQs</h2>
              <MobileAccordion
                sections={[
                  {
                    title: "Questions people ask",
                    items: service.faqs.map((f) => ({ strong: f.q, text: f.a })),
                  },
                ]}
                defaultOpen={true}
              />
            </section>
          ) : null}

          {service.internalLinks?.length ? (
            <section class="section section-padding" aria-label="Related pages">
              <h2 class="section-title">Related pages</h2>
              <div class="grid grid-2">
                {service.internalLinks.map((l) => (
                  <a class="card" href={l.href}>
                    <h3 class="card-title">{l.label}</h3>
                    <p class="card-desc">Open</p>
                  </a>
                ))}
              </div>
            </section>
          ) : null}

          <section aria-label="Contact CTA">
            <FooterCtaBar
              title={siteData.footerCtas.title}
              subtitle={siteData.footerCtas.subtitle}
              whatsappNumber={siteData.brand.whatsappE164}
              whatsappText={siteData.brand.whatsappPrefill}
              callNumber={siteData.brand.phoneE164}
              callLabel={siteData.footerCtas.callLabel}
              brandName={siteData.footerCtas.brandName}
              logoText={siteData.footerCtas.logoText}
              copyright={siteData.footerCtas.copyright}
            />
          </section>
        </div>

        <div class="ui-mobile">
          <header>
            <MobileHero
              brand={{
                name: siteData.brand.name,
                tagline: siteData.brand.tagline,
                subtitle: service.heroP,
                phone: siteData.brand.phone,
                areaChips: [],
              }}
            />
          </header>

          <section class="section section-padding">
            <h1 class="section-title">{service.heroH1}</h1>
            <p class="section-sub">{service.heroP}</p>
          </section>

          <section class="section section-padding">
            <h2 class="section-title">Who this is for</h2>
            <ul class="bullets">
              {service.whoFor?.map((x) => <li>{x}</li>)}
            </ul>
          </section>

          <section class="section section-padding">
            <h2 class="section-title">Local context</h2>
            <p class="readable">{service.localFit}</p>
          </section>

          <section class="section section-padding">
            <h2 class="section-title">What we focus on</h2>
            <ul class="bullets">
              {service.keyCoverFocus?.map((x) => <li>{x}</li>)}
            </ul>
          </section>

          <section class="section section-padding">
            <h2 class="section-title">Claim-ready documents</h2>
            <ul class="bullets">
              {service.claimDocs?.map((x) => <li>{x}</li>)}
            </ul>
          </section>

          <section class="section section-padding">
            <h2 class="section-title">Common mistakes we prevent</h2>
            <ul class="bullets">
              {service.commonMistakes?.map((x) => <li>{x}</li>)}
            </ul>
          </section>

          {service.faqs?.length ? (
            <section class="section section-padding">
              <MobileAccordion
                sections={[
                  {
                    title: "FAQs",
                    items: service.faqs.map((f) => ({ strong: f.q, text: f.a })),
                  },
                ]}
                defaultOpen={true}
              />
            </section>
          ) : null}

          <section aria-label="Contact CTA">
            <FooterCtaBar
              title={siteData.footerCtas.title}
              subtitle={siteData.footerCtas.subtitle}
              whatsappNumber={siteData.brand.whatsappE164}
              whatsappText={siteData.brand.whatsappPrefill}
              callNumber={siteData.brand.phoneE164}
              callLabel={siteData.footerCtas.callLabel}
              brandName={siteData.footerCtas.brandName}
              logoText={siteData.footerCtas.logoText}
              copyright={siteData.footerCtas.copyright}
            />
          </section>
        </div>
      </div>
    </main>

    <FloatingContactCta brand={siteData.brand} />
  </body>
</html>
