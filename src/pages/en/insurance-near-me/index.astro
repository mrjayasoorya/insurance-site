---
import DesktopHero from "../../../components/DesktopHero.astro";
import MobileHero from "../../../components/MobileHero.astro";
import MobileAccordion from "../../../components/MobileAccordion.astro";
import LocalIdentitySection from "../../../components/LocalIdentitySection.astro";
import BacklinksRow from "../../../components/BacklinksRow.astro";
import FooterCtaBar from "../../../components/FooterCtaBar.astro";
import FloatingMenu from "src/components/FloatingMenu.astro";
import FloatingContactCta from "src/components/FloatingContactCta.astro";

import { siteData, EN } from "../../../content/siteData";
import { canonicalFromPath, buildMeta, buildJsonLd } from "../../../lib/seo";
import ConversionBlock from "src/components/ConversionBlock.astro";

const page = siteData.intentPages["insurance-near-me"];

const canonical = canonicalFromPath(siteData.brand.websiteUrl, "/en/insurance-near-me/");
const meta = buildMeta({
  title: `${page.seoTitle} | ${siteData.brand.name}`,
  description: page.seoDesc,
  canonical,
});

const jsonLd = buildJsonLd({
  pageType: "intent",
  canonical,
  siteData,
  title: meta.title,
  description: meta.description,
  breadcrumbs: [
    { name: "Home", href: canonicalFromPath(siteData.brand.websiteUrl, "/en/") },
    { name: "Insurance Near Me", href: canonical },
  ],
  serviceData: page,
  faqs: page.faqs || [],
});
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/assets/logo/MNRajendraKumar_Insurance_services_logo_48x48px_white_bg_icon.png"/>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{meta.title}</title>
    <meta name="description" content={meta.description} />
    <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />
    <meta name="googlebot" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1" />
    <link rel="canonical" href={meta.canonical} />
    <link rel="stylesheet" href="/styles/theme.css" />
    {Object.entries(meta.tags).map(([k, v]) => <meta property={k} content={v} />)}
{Object.entries(meta.nameTags || {}).map(([k, v]) => <meta name={k} content={v} />)}
    <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  </head>

  <body>
    <main class="app">
      <div class="container">

        <!-- DESKTOP -->
        <div class="ui-desktop">
          <header>
            <DesktopHero brand={{
              name: siteData.brand.name,
              tagline: siteData.brand.tagline,
              subtitle: page.heroP,
              phone: siteData.brand.phone,
              areaChips: siteData.brand.areaChips,
            }} />
          </header>

          <section class="section section-padding">
            <h1 class="section-title">{page.heroH1}</h1>
            <p class="section-sub readable">{page.heroP}</p>
          </section>

          <section class="section section-padding" aria-label="Who this helps">
            <h2 class="section-title">Who this helps</h2>
            <ul class="bullets">{page.whoThisHelps.map((x) => <li>{x}</li>)}</ul>
          </section>

          <section class="section section-padding" aria-label="What you get">
            <h2 class="section-title">What you get</h2>
            <ul class="bullets">{page.whatYouGet.map((x) => <li>{x}</li>)}</ul>
          </section>

          <section class="section section-padding" aria-label="How support works">
            <h2 class="section-title">How support works</h2>
            <ul class="area-rows" role="list">
              {page.howSupportWorks.map((s) => (
                <li class="area-row">
                  <h3 class="area-name">{s.title}</h3>
                  <p class="area-notes">{s.text}</p>
                </li>
              ))}
            </ul>
          </section>

          <section class="section section-padding" aria-label="Office support">
            <h2 class="section-title">{page.office.title}</h2>
            <ul class="bullets">{page.office.bullets.map((x) => <li>{x}</li>)}</ul>

            {siteData.brand.gbpUrl ? (
              <p class="section-sub" style="margin-top:10px">
                <a class="inline-link" href={siteData.brand.gbpUrl} target="_blank" rel="noopener">
                  Open Google Maps listing
                </a>
              </p>
            ) : null}
          </section>

          <section class="section section-padding" aria-label="Areas we commonly support">
            <h2 class="section-title">{page.commonAreasTitle}</h2>
            <p class="section-sub readable">
              See the locations page for area-wise guidance. We avoid copying service content into area pages.
            </p>
            <p class="section-sub" style="margin-top:10px">
              <a class="inline-link" href={page.commonAreasCta.href}>{page.commonAreasCta.label}</a>
            </p>
          </section>

          <section class="section section-padding" aria-label="Recommended pages">
            <h2 class="section-title">Recommended pages</h2>
            <div class="grid grid-2">
              {page.recommendedServices.map((x) => (
                <a class="card" href={x.href}>
                  <h3 class="card-title">{x.label}</h3>
                  <p class="card-desc">Open</p>
                </a>
              ))}
            </div>
          </section>
<ConversionBlock 
siteData={siteData}
  block={siteData.conversionBlocks.default}
  brand={siteData.brand}
/>
          {page.faqs?.length ? (
            <section class="section section-padding" aria-label="FAQs">
              <h2 class="section-title">FAQs</h2>
              <MobileAccordion
                sections={[{
                  title: "Questions people ask",
                  items: page.faqs.map((f) => ({ strong: f.q, text: f.a })),
                }]}
                defaultOpen={true}
              />
            </section>
          ) : null}

          <LocalIdentitySection brand={siteData.brand} pageTitle="Insurance near me" />
          <BacklinksRow title={siteData.backlinks.title} links={siteData.backlinks.links} />

          <FooterCtaBar
            title={siteData.footerCtas.title}
            subtitle={siteData.footerCtas.subtitle}
            whatsappNumber={siteData.brand.whatsappE164}
            whatsappText={siteData.brand.whatsappPrefill}
            callNumber={siteData.brand.phoneE164}
            callLabel={siteData.footerCtas.callLabel}
            brandName={siteData.footerCtas.brandName}
            logoText={siteData.footerCtas.logoText}
            copyright={siteData.footerCtas.copyright}
          />
        </div>

        <!-- MOBILE -->
        <div class="ui-mobile">
          <header>
            <MobileHero brand={{
              name: siteData.brand.name,
              tagline: siteData.brand.tagline,
              subtitle: page.heroP,
              phone: siteData.brand.phone,
              areaChips: [],
            }} />
          </header>

          <section class="section section-padding">
            <h1 class="section-title">{page.heroH1}</h1>
            <p class="section-sub readable">{page.heroP}</p>
          </section>

          <section class="section section-padding">
            <h2 class="section-title">Who this helps</h2>
            <ul class="bullets">{page.whoThisHelps.map((x) => <li>{x}</li>)}</ul>
          </section>

          <section class="section section-padding">
            <h2 class="section-title">How support works</h2>
            <ul class="area-rows" role="list">
              {page.howSupportWorks.map((s) => (
                <li class="area-row">
                  <h3 class="area-name">{s.title}</h3>
                  <p class="area-notes">{s.text}</p>
                </li>
              ))}
            </ul>
          </section>

          <section class="section section-padding">
            <h2 class="section-title">Recommended pages</h2>
            <div class="grid grid-1">
              {page.recommendedServices.map((x) => (
                <a class="card" href={x.href}>
                  <h3 class="card-title">{x.label}</h3>
                  <p class="card-desc">Open</p>
                </a>
              ))}
            </div>
          </section>
<ConversionBlock 
siteData={siteData}
  block={siteData.conversionBlocks.default}
  brand={siteData.brand}
/>
          {page.faqs?.length ? (
            <section class="section section-padding">
              <MobileAccordion
                sections={[{
                  title: "FAQs",
                  items: page.faqs.map((f) => ({ strong: f.q, text: f.a })),
                }]}
                defaultOpen={true}
              />
            </section>
          ) : null}

          <LocalIdentitySection brand={siteData.brand} pageTitle="Insurance near me" />
          <BacklinksRow title={siteData.backlinks.title} links={siteData.backlinks.links} />

          <FooterCtaBar
            title={siteData.footerCtas.title}
            subtitle={siteData.footerCtas.subtitle}
            whatsappNumber={siteData.brand.whatsappE164}
            whatsappText={siteData.brand.whatsappPrefill}
            callNumber={siteData.brand.phoneE164}
            callLabel={siteData.footerCtas.callLabel}
            brandName={siteData.footerCtas.brandName}
            logoText={siteData.footerCtas.logoText}
            copyright={siteData.footerCtas.copyright}
          />
        </div>

      </div>
    </main>

    <FloatingMenu brand={siteData.brand} />
    <FloatingContactCta brand={siteData.brand} />

    <style is:global>
      .readable{max-width:78ch}
      .grid{display:grid;gap:12px}
      .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
      .grid-1{grid-template-columns:1fr}
      .card{display:block;padding:14px;border:1px solid rgba(255,255,255,.12);border-radius:14px;text-decoration:none}
      .card-title{font-size:16px;margin:8px 0 6px}
      .card-desc{margin:0;opacity:.85}
      .inline-link{font-weight:900;text-decoration:underline;text-underline-offset:3px}
      .area-rows{margin:14px 0 0;padding:0;list-style:none;display:flex;flex-direction:column;gap:12px}
      .area-row{border:1px solid var(--border);border-radius:18px;background:var(--surface);box-shadow:0 2px 10px rgba(11,13,18,.05);padding:12px 14px}
      .area-name{margin:0;font-size:15px;font-weight:950;letter-spacing:-0.01em}
      .area-notes{margin:8px 0 0;color:var(--muted);font-size:13px;line-height:1.4}
      @media (max-width: 980px){.grid-2{grid-template-columns:1fr}}
    </style>
  </body>
</html>
