---
// src/pages/en/index.astro

import DesktopHero from "../../components/DesktopHero.astro";
import DesktopCoreServices from "../../components/DesktopCoreServices.astro";
import DesktopMarketplace from "../../components/DesktopMarketplace.astro";

import MobileHero from "../../components/MobileHero.astro";
import MobileCoreServices from "../../components/MobileCoreServices.astro";
import MobileAccordion from "../../components/MobileAccordion.astro";

import TestimonialsStrip from "../../components/TestimonialsStrip.astro";
import StatsStrip from "../../components/StatsStrip.astro";
import FooterCtaBar from "../../components/FooterCtaBar.astro";
import BlogSection from "../../components/BlogSection.astro";
import CoverageIndexSection from "../../components/CoverageIndexSection.astro";
import LinksHubSection from "../../components/LinksHubSection.astro";
import LocalIdentitySection from "../../components/LocalIdentitySection.astro";

import { siteData, EN } from "../../content/siteData";

import FloatingContactCta from "src/components/FloatingContactCta.astro";
import FloatingMenu from "src/components/FloatingMenu.astro";
import BacklinksRow from "../../components/BacklinksRow.astro";
import GooglePostsPhotosSection from "../../components/GooglePostsPhotosSection.astro";
import NearMeTrustSection from "src/components/NearMeTrustSection.astro";
import { buildJsonLd, buildMeta, canonicalFromPath } from "src/lib/seo";
import QuickHelpLinks from "src/components/QuickHelpLinks.astro";


// -----------------------------
// BLOG DATA NORMALIZATION
// -----------------------------
const commercialAuthorityPosts = {
  ...siteData.commercialAuthorityPosts,
  viewAllHref: EN(siteData.commercialAuthorityPosts?.viewAllHref || "/commercial-authority/"),
  viewMoreHref: EN(siteData.commercialAuthorityPosts?.viewMoreHref || "/commercial-authority/"),
  categories: (siteData.commercialAuthorityPosts?.categories || []).map((c) => ({
    ...c,
    items: (c.items || []).map((it) => ({ ...it, href: EN(it.href) })),
  })),
};

const proofExperiencePosts = {
  ...siteData.proofExperiencePosts,
  viewAllHref: EN(siteData.proofExperiencePosts?.viewAllHref || "/proof-experience/"),
  viewMoreHref: EN(siteData.proofExperiencePosts?.viewMoreHref || "/proof-experience/"),
  items: (siteData.proofExperiencePosts?.items || []).map((it) => ({ ...it, href: EN(it.href) })),
};

const renewalLicPosts = {
  ...siteData.renewalLicPosts,
  viewAllHref: EN(siteData.renewalLicPosts?.viewAllHref || "/renewals/"),
  viewMoreHref: EN(siteData.renewalLicPosts?.viewMoreHref || "/renewals/"),
  items: (siteData.renewalLicPosts?.items || []).map((it) => ({ ...it, href: EN(it.href) })),
};

const insights = {
  ...siteData.insights,
  viewAllHref: EN(siteData.insights?.viewAllHref || "/insights/"),
  viewMoreHref: EN(siteData.insights?.viewMoreHref || "/insights/"),
  items: (siteData.insights?.items || []).map((it) => ({ ...it, href: EN(it.href) })),
};

// -----------------------------
// SERVICES (SYNCED)
// Home should highlight authority categories, not random old slugs.
// -----------------------------
const serviceCategoryCards = (siteData.serviceCategories || []).map((c) => ({
  tag: "Category",
  title: c.title,
  desc: c.desc,
  href: c.href, // already EN("/services/<category>/")
}));

// “Most requested” service detail pages (transactional intent)
const popularServices = (siteData.servicePopular || []).map((x) => ({
  ...x,
  href: x.href,
}));

// -----------------------------
// LOCATIONS (SYNCED)
// Home should link to locations hub + few top location detail pages.
// -----------------------------
const topLocations =
  siteData.locationsIndex?.groups?.flatMap((g) => g.locations || []).slice(0, 10) || [];

const smallHomeFaq = [
  {
    q: "Do you support customers only in Sholavaram?",
    a:
      "Sholavaram is our primary base. We commonly support Chennai North and nearby corridors depending on the policy type and insurer requirements.",
  },
  {
    q: "Can you help with insurance renewals and policy checks?",
    a:
      "Yes. We assist with renewal checks, add-on clarity and documentation discipline to reduce avoidable claim issues later.",
  },
  {
    q: "Do you promise claim approval?",
    a:
      "No. Claim outcomes depend on policy terms, disclosures and insurer processes. We guide correct steps and documents to reduce avoidable delays.",
  },
];
const canonical = canonicalFromPath(siteData.brand.websiteUrl, "/en/");
const meta = buildMeta({
  title: `${siteData.pageFlow.heroH1} | ${siteData.brand.name}`,
  description: siteData.brand.subtitle,
  canonical,
});
const homeFaqPicks = [
  { group: "claimsDocs", index: 0 },
  { group: "claimsDocs", index: 1 },
  { group: "claimsDocs", index: 2 },
  { group: "locationsOffice", index: 0 },
  { group: "locationsOffice", index: 3 },
  { group: "locationsOffice", index: 4 },
  { group: "experienceTrust", index: 0 },
  { group: "experienceTrust", index: 2 },
  { group: "transportFleet", index: 0 },
]

const homeFaqItems = (homeFaqPicks || [])
  .map(({ group, index }) => siteData.faqsPage?.[group]?.items?.[index])
  .filter(Boolean);


const jsonLd = buildJsonLd({
  pageType: "home",
  siteData,
  canonical,
  title: meta.title,
  description: meta.description,
  // Keep FAQPage small here, or omit faqs entirely
  faqs: homeFaqItems || [],
});
---

<html lang="en">
  <head>

    <title>{meta.title}</title>
  <meta name="description" content={meta.description} />
  <link rel="canonical" href={meta.canonical} />
  {Object.entries(meta.tags).map(([k,v]) => <meta property={k} content={v} />)}
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />


    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="/styles/theme.css" />
  </head>

  <body>
    <a class="skip-link" href="#main">Skip to content</a>

    <main id="main" class="app">
      <div class="container">
        <!-- ========================= DESKTOP ========================= -->
        <div class="ui-desktop">
          <header>
            <DesktopHero
              brand={{
                name: siteData.brand.name,
                tagline: siteData.brand.tagline,
                subtitle: siteData.pageFlow.heroP,
                phone: siteData.brand.phone,
                areaChips: siteData.brand.areaChips,
              }}
            />
          </header>

          <main>
            <section class="section section-padding" aria-labelledby="who-title">
              <h2 id="who-title" class="section-title">{siteData.primaryIndustries.title}</h2>
              <p class="section-sub">{siteData.primaryIndustries.subtitle}</p>
              <div class="grid grid-2">
                {siteData.primaryIndustries.items.map((it) => (
                  <article class="card" aria-label={it.title}>
                    <h3 class="card-title">{it.title}</h3>
                    <p class="card-desc">{it.desc}</p>
                  </article>
                ))}
              </div>
            </section>

            <section class="section section-padding" aria-labelledby="risk-title">
              <h2 id="risk-title" class="section-title">{siteData.localRiskContext.title}</h2>
              <p class="section-sub">{siteData.localRiskContext.subtitle}</p>
              <ul class="bullets">{siteData.localRiskContext.points.map((p) => <li>{p}</li>)}</ul>
            </section>

            <section class="section section-padding" aria-labelledby="claimsxp-title">
              <h2 id="claimsxp-title" class="section-title">{siteData.claimExperience.title}</h2>
              <p class="section-sub">{siteData.claimExperience.subtitle}</p>
              <ul class="bullets">{siteData.claimExperience.points.map((p) => <li>{p}</li>)}</ul>
            </section>

            <!-- Services: category authority first -->
            <section class="section section-padding" aria-labelledby="svc-cat-title">
              <h2 id="svc-cat-title" class="section-title">Insurance categories we support</h2>
              <p class="section-sub readable">
                Start with a category. Then pick the exact service page for decision-level guidance.
              </p>
              <DesktopCoreServices services={serviceCategoryCards} />
            </section>

            <!-- Popular service detail pages (transactional) -->
            <section class="section section-padding" aria-labelledby="svc-pop-title">
              <h2 id="svc-pop-title" class="section-title">Most requested services</h2>
              <div class="grid grid-2">
                {popularServices.slice(0, 8).map((x) => (
                  <a class="card" href={x.href}>
                    <div class="card-row"><span class="chip">{x.tag}</span></div>
                    <h3 class="card-title">{x.title}</h3>
                    <p class="card-desc">Open guidance</p>
                  </a>
                ))}
              </div>
            </section>

            <!-- Locations entry-point -->
            <section class="section section-padding" aria-labelledby="loc-title">
              <h2 id="loc-title" class="section-title">Locations we commonly support</h2>
              <p class="section-sub readable">
                Local support anchored to Sholavaram office guidance. See location pages for local context (without duplicating service content).
              </p>

              <div class="grid grid-2">
                <a class="card" href={EN("/locations/")}>
                  <h3 class="card-title">View all locations</h3>
                  <p class="card-desc">Sholavaram • Red Hills • Madhavaram • Ambattur and nearby belts</p>
                </a>

                {topLocations.slice(0, 5).map((l) => (
                  <a class="card" href={EN(`/locations/${l.slug}/`)}>
                    <h3 class="card-title">{l.name}</h3>
                    <p class="card-desc">Open local guide</p>
                  </a>
                ))}
              </div>
            </section>

            <GooglePostsPhotosSection
              title={siteData.media.googlePosts.title}
              subtitle={siteData.media.googlePosts.subtitle}
              images={siteData.media.googlePosts.images}
              ctaLabel="Photos"
              ctaHref={EN("/photos/")}
            />

            <section class="section section-padding" aria-label="Quick links">
              <div class="grid grid-2">
                <a class="card" href={EN("/services/")}>
                  <h3 class="card-title">All Services</h3>
                  <p class="card-desc">Service hub → categories → detail pages</p>
                </a>
                <a class="card" href={EN("/faqs/")}>
                  <h3 class="card-title">FAQs</h3>
                  <p class="card-desc">Claims, renewals, documents, office and locations</p>
                </a>
                <a class="card" href={EN("/commercial-authority/")}>
                  <h3 class="card-title">Commercial Authority</h3>
                  <p class="card-desc">NH + industrial belt guidance</p>
                </a>
                <a class="card" href={EN("/renewals/")}>
                  <h3 class="card-title">Renewals</h3>
                  <p class="card-desc">Car/lorry/LIC continuity checklists</p>
                </a>
              </div>
            </section>

            <section class="section" aria-labelledby="authority-title">
              <h2 id="authority-title" class="sr-only">Industry-focused guidance</h2>
              <BlogSection
                title={commercialAuthorityPosts.title}
                subtitle={commercialAuthorityPosts.subtitle}
                viewAllHref={commercialAuthorityPosts.viewAllHref}
                viewMoreHref={commercialAuthorityPosts.viewMoreHref}
                categories={commercialAuthorityPosts.categories}
              />
            </section>

            <CoverageIndexSection data={siteData.coverageIndex} />

            <section class="section" aria-labelledby="proof-title">
              <h2 id="proof-title" class="sr-only">Proof & experience</h2>
              <BlogSection
                title={proofExperiencePosts.title}
                subtitle={proofExperiencePosts.subtitle}
                viewAllHref={proofExperiencePosts.viewAllHref}
                viewMoreHref={proofExperiencePosts.viewMoreHref}
                items={proofExperiencePosts.items}
                showSaveButton={false}
              />
            </section>

            <section class="section" aria-labelledby="renew-title">
              <h2 id="renew-title" class="sr-only">Renewal support</h2>
              <BlogSection
                title={renewalLicPosts.title}
                subtitle={renewalLicPosts.subtitle}
                viewAllHref={renewalLicPosts.viewAllHref}
                viewMoreHref={renewalLicPosts.viewMoreHref}
                items={renewalLicPosts.items}
                showSaveButton={false}
              />
            </section>

            <section class="section" aria-labelledby="insights-title">
              <h2 id="insights-title" class="sr-only">Insights</h2>
              <BlogSection
                title={insights.title}
                subtitle={insights.subtitle}
                viewAllHref={insights.viewAllHref}
                viewMoreHref={insights.viewMoreHref}
                items={insights.items}
                showSaveButton={false}
              />
            </section>

            <section class="section section-padding" aria-labelledby="how-it-works-title">
              <h2 id="how-it-works-title" class="section-title">How you’ll get help</h2>
              <div class="section-sub">Coverage clarity → documentation discipline → smoother workflows.</div>

              <MobileAccordion
                sections={[
                  ...siteData.howWeHelp,
                  { title: "FAQs (quick)", items: smallHomeFaq.map((f) => ({ strong: f.q, text: f.a })) },
                ]}
                defaultOpen={true}
              />
            </section>

            <LocalIdentitySection brand={siteData.brand} pageTitle="Home" />
            <NearMeTrustSection data={{ nearMeIntent: siteData.nearMeIntent, trustValidation: siteData.trustValidation }} />
            <LinksHubSection data={siteData.linksHub} />
            <BacklinksRow title={siteData.backlinks.title} links={siteData.backlinks.links} />
<QuickHelpLinks pageType="home" />
            <section aria-labelledby="contact-title">
              <h2 id="contact-title" class="sr-only">Contact</h2>
              <FooterCtaBar
                title={siteData.footerCtas.title}
                subtitle={siteData.footerCtas.subtitle}
                whatsappNumber={siteData.brand.whatsappE164}
                whatsappText={siteData.brand.whatsappPrefill}
                callNumber={siteData.brand.phoneE164}
                callLabel={siteData.footerCtas.callLabel}
                brandName={siteData.footerCtas.brandName}
                logoText={siteData.footerCtas.logoText}
                copyright={siteData.footerCtas.copyright}
              />
            </section>
          </main>
        </div>

        <!-- ========================= MOBILE ========================= -->
        <div class="ui-mobile">
          <header>
            <MobileHero
              brand={{
                name: siteData.brand.name,
                tagline: siteData.brand.tagline,
                subtitle: siteData.pageFlow.heroP,
                phone: siteData.brand.phone,
                areaChips: [],
              }}
            />
          </header>

          <main>
            <section class="section section-padding">
              <h2 class="section-title">{siteData.primaryIndustries.title}</h2>
              <p class="section-sub">{siteData.primaryIndustries.subtitle}</p>
              <div class="grid grid-1">
                {siteData.primaryIndustries.items.map((it) => (
                  <article class="card" aria-label={it.title}>
                    <h3 class="card-title">{it.title}</h3>
                    <p class="card-desc">{it.desc}</p>
                  </article>
                ))}
              </div>
            </section>

            <section class="section section-padding">
              <h2 class="section-title">{siteData.localRiskContext.title}</h2>
              <p class="section-sub">{siteData.localRiskContext.subtitle}</p>
              <ul class="bullets">{siteData.localRiskContext.points.map((p) => <li>{p}</li>)}</ul>
            </section>

            <section class="section section-padding">
              <h2 class="section-title">{siteData.claimExperience.title}</h2>
              <p class="section-sub">{siteData.claimExperience.subtitle}</p>
              <ul class="bullets">{siteData.claimExperience.points.map((p) => <li>{p}</li>)}</ul>
            </section>

            <section class="section section-padding">
              <h2 class="section-title">Insurance categories</h2>
              <MobileCoreServices services={serviceCategoryCards} />
            </section>

            <section class="section section-padding">
              <h2 class="section-title">Most requested services</h2>
              <div class="grid grid-1">
                {popularServices.slice(0, 8).map((x) => (
                  <a class="card" href={x.href}>
                    <div class="card-row"><span class="chip">{x.tag}</span></div>
                    <h3 class="card-title">{x.title}</h3>
                    <p class="card-desc">Open</p>
                  </a>
                ))}
              </div>
            </section>

            <section class="section section-padding">
              <h2 class="section-title">Locations we support</h2>
              <div class="grid grid-1">
                <a class="card" href={EN("/locations/")}>
                  <h3 class="card-title">View all locations</h3>
                  <p class="card-desc">Local context pages</p>
                </a>
                {topLocations.slice(0, 6).map((l) => (
                  <a class="card" href={EN(`/locations/${l.slug}/`)}>
                    <h3 class="card-title">{l.name}</h3>
                    <p class="card-desc">Open local guide</p>
                  </a>
                ))}
              </div>
            </section>

            <GooglePostsPhotosSection
              title={siteData.media.googlePosts.title}
              subtitle={siteData.media.googlePosts.subtitle}
              images={siteData.media.googlePosts.images}
              ctaLabel="Photos"
              ctaHref={EN("/photos/")}
            />

            <CoverageIndexSection data={siteData.coverageIndex} />

            <section class="section section-padding">
              <MobileAccordion
                sections={[
                  ...siteData.howWeHelp,
                  { title: "FAQs (quick)", items: smallHomeFaq.map((f) => ({ strong: f.q, text: f.a })) },
                ]}
                defaultOpen={true}
              />
            </section>

            <LocalIdentitySection brand={siteData.brand} pageTitle="Home" />
            <NearMeTrustSection data={{ nearMeIntent: siteData.nearMeIntent, trustValidation: siteData.trustValidation }} />
            <LinksHubSection data={siteData.linksHub} />
            <BacklinksRow title={siteData.backlinks.title} links={siteData.backlinks.links} />
            <QuickHelpLinks pageType="home" />
            <FooterCtaBar
              title={siteData.footerCtas.title}
              subtitle={siteData.footerCtas.subtitle}
              whatsappNumber={siteData.brand.whatsappE164}
              whatsappText={siteData.brand.whatsappPrefill}
              callNumber={siteData.brand.phoneE164}
              callLabel={siteData.footerCtas.callLabel}
              brandName={siteData.footerCtas.brandName}
              logoText={siteData.footerCtas.logoText}
              copyright={siteData.footerCtas.copyright}
            />
          </main>
        </div>
      </div>
    </main>

    <FloatingMenu brand={siteData.brand} />
    <FloatingContactCta brand={siteData.brand} />
  </body>
</html>
