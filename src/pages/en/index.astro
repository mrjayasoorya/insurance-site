---
// src/pages/index.astro
// ✅ Home page rewrite (desktop + mobile same sequencing, same theme)
// No new components required; uses your existing components + small semantic sections.

import DesktopHero from "../../components/DesktopHero.astro";
import DesktopCoreServices from "../../components/DesktopCoreServices.astro";
import DesktopMarketplace from "../../components/DesktopMarketplace.astro";

import MobileHero from "../../components/MobileHero.astro";
import MobileCoreServices from "../../components/MobileCoreServices.astro";
import MobileAccordion from "../../components/MobileAccordion.astro";

import TestimonialsStrip from "../../components/TestimonialsStrip.astro";
import StatsStrip from "../../components/StatsStrip.astro";
import FooterCtaBar from "../../components/FooterCtaBar.astro";
import BlogSection from "../../components/BlogSection.astro";
import CoverageIndexSection from "../../components/CoverageIndexSection.astro";

import { siteData } from "../../content/siteData";
import FloatingContactCta from "src/components/FloatingContactCta.astro";

const telHref = `tel:${siteData.brand.phoneE164}`;
const waHref =
  `https://wa.me/${encodeURIComponent(siteData.brand.whatsappE164)}` +
  `?text=${encodeURIComponent(siteData.brand.whatsappPrefill)}`;

// ✅ One clean JSON-LD graph (avoid duplicates)
const canonical = siteData.brand.websiteUrl || "https://rajendrakumarinsurance.in/";
const jsonLd = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      name: siteData.brand.name,
      legalName: siteData.brand.legalName,
      telephone: siteData.brand.phoneE164,
      url: canonical,
      sameAs: [siteData.brand.gbpUrl].filter(Boolean),
    },
    {
      "@type": "InsuranceAgency",
      name: siteData.brand.name,
      telephone: siteData.brand.phoneE164,
      url: canonical,
      sameAs: [siteData.brand.gbpUrl].filter(Boolean),
      hasMap: siteData.brand.gbpUrl || undefined,
      areaServed: siteData.brand.areaChips,
      address: {
        "@type": "PostalAddress",
        streetAddress: siteData.brand.streetAddress || undefined,
        addressLocality: siteData.brand.addressLocality,
        addressRegion: siteData.brand.addressRegion,
        postalCode: siteData.brand.postalCode || undefined,
        addressCountry: siteData.brand.addressCountry,
      },
      geo: siteData.brand.geo
        ? { "@type": "GeoCoordinates", latitude: siteData.brand.geo.lat, longitude: siteData.brand.geo.lng }
        : undefined,
      openingHoursSpecification: siteData.brand.hours?.is24x7
        ? [{
            "@type": "OpeningHoursSpecification",
            dayOfWeek: ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],
            opens: "00:00",
            closes: "23:59",
          }]
        : undefined,
    },
    {
      "@type": "FAQPage",
      mainEntity: siteData.faqs.map((f) => ({
        "@type": "Question",
        name: f.q,
        acceptedAnswer: { "@type": "Answer", text: f.a },
      })),
    },
    ...siteData.coreServices.map((s) => ({
      "@type": "Service",
      name: s.title,
      serviceType: s.tag,
      areaServed: siteData.brand.areaChips,
      provider: { "@type": "Organization", name: siteData.brand.name },
      description: s.desc,
    })),
  ],
};
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <title>{siteData.pageFlow.heroH1} | {siteData.brand.name}</title>
    <meta name="description" content={siteData.brand.subtitle} />
    <link rel="canonical" href={canonical} />

    <meta property="og:title" content={`${siteData.pageFlow.heroH1} | ${siteData.brand.name}`} />
    <meta property="og:description" content={siteData.brand.subtitle} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonical} />

    <meta name="twitter:card" content="summary_large_image" />

    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="/styles/theme.css" />

    <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  </head>

  <body>
    <a class="skip-link" href="#main">Skip to content</a>

    <main id="main" class="app">
      <div class="container">

        <!-- =========================
             DESKTOP UI
        ========================== -->
        <div class="ui-desktop">
          <header>
            <DesktopHero
              brand={{
                name: siteData.brand.name,
                tagline: siteData.brand.tagline,
                subtitle: siteData.pageFlow.heroP,
                phone: siteData.brand.phone,
                areaChips: siteData.brand.areaChips,
              }}
            />
          </header>

          <main>
            <!-- ✅ SECTION 2: WHO we help (industry anchoring) -->
            <section class="section section-padding" aria-labelledby="who-title">
              <h2 id="who-title" class="section-title">{siteData.primaryIndustries.title}</h2>
              <p class="section-sub">{siteData.primaryIndustries.subtitle}</p>

              <div class="grid grid-2">
                {siteData.primaryIndustries.items.map((it) => (
                  <article class="card" aria-label={it.title}>
                    <h3 class="card-title">{it.title}</h3>
                    <p class="card-desc">{it.desc}</p>
                  </article>
                ))}
              </div>
            </section>

            <!-- ✅ SECTION 3: Local risk intelligence -->
            <section class="section section-padding" aria-labelledby="risk-title">
              <h2 id="risk-title" class="section-title">{siteData.localRiskContext.title}</h2>
              <p class="section-sub">{siteData.localRiskContext.subtitle}</p>
              <ul class="bullets">
                {siteData.localRiskContext.points.map((p) => <li>{p}</li>)}
              </ul>
            </section>

            <!-- ✅ SECTION 4: Claim-side authority (non-generic) -->
            <section class="section section-padding" aria-labelledby="claimsxp-title">
              <h2 id="claimsxp-title" class="section-title">{siteData.claimExperience.title}</h2>
              <p class="section-sub">{siteData.claimExperience.subtitle}</p>
              <ul class="bullets">
                {siteData.claimExperience.points.map((p) => <li>{p}</li>)}
              </ul>
            </section>

            <!-- ✅ SECTION 5: Services (clean) -->
            <section aria-labelledby="core-services-title">
              <h2 id="core-services-title" class="sr-only">Core services</h2>
              <DesktopCoreServices services={siteData.coreServices} />
            </section>

            <!-- ✅ Local highlights -->
            <section class="section section-padding" aria-labelledby="local-support-title">
              <h2 id="local-support-title" class="sr-only">Local support highlights</h2>
              <DesktopMarketplace cards={siteData.marketplaceCards} phone={siteData.brand.phone} />
            </section>

            <!-- ✅ Commercial authority BEFORE general insights -->
            <section class="section" aria-labelledby="authority-title">
              <h2 id="authority-title" class="sr-only">Industry-focused guidance</h2>
              <BlogSection
                title={siteData.commercialAuthorityPosts.title}
                subtitle={siteData.commercialAuthorityPosts.subtitle}
                viewAllHref={siteData.commercialAuthorityPosts.viewAllHref}
                viewMoreHref={siteData.commercialAuthorityPosts.viewMoreHref}
                categories={siteData.commercialAuthorityPosts.categories}
              />
            </section>

            <!-- <section class="section section-padding"> -->
              <CoverageIndexSection data={siteData.coverageIndex} />
            <!-- </section> -->

            <!-- ✅ Proof + Renewals (supporting) -->
            <section class="section" aria-labelledby="proof-title">
              <h2 id="proof-title" class="sr-only">Proof & experience</h2>
              <BlogSection
                title={siteData.proofExperiencePosts.title}
                subtitle={siteData.proofExperiencePosts.subtitle}
                viewAllHref={siteData.proofExperiencePosts.viewAllHref}
                viewMoreHref={siteData.proofExperiencePosts.viewMoreHref}
                items={siteData.proofExperiencePosts.items}
                showSaveButton={false}
              />
            </section>

            <section class="section" aria-labelledby="renew-title">
              <h2 id="renew-title" class="sr-only">Renewal support</h2>
              <BlogSection
                title={siteData.renewalLicPosts.title}
                subtitle={siteData.renewalLicPosts.subtitle}
                viewAllHref={siteData.renewalLicPosts.viewAllHref}
                viewMoreHref={siteData.renewalLicPosts.viewMoreHref}
                items={siteData.renewalLicPosts.items}
                showSaveButton={false}
              />
            </section>

            <!-- ✅ Insights LAST (so intent stays commercial-first) -->
            <section class="section" aria-labelledby="insights-title">
              <h2 id="insights-title" class="sr-only">Insights</h2>
              <BlogSection
                title={siteData.insights.title}
                subtitle={siteData.insights.subtitle}
                viewAllHref={siteData.insights.viewAllHref}
                viewMoreHref={siteData.insights.viewMoreHref}
                items={siteData.insights.items}
                showSaveButton={false}
              />
            </section>

            <!-- ✅ How we help + contextual FAQs (kept tight) -->
            <section class="section section-padding" aria-labelledby="how-it-works-title">
              <h2 id="how-it-works-title" class="section-title">How you’ll get help</h2>
              <div class="section-sub">
                Coverage clarity → wording + documentation discipline → smoother claim workflows.
              </div>

              <MobileAccordion
                sections={[
                  ...siteData.howWeHelp,
                  {
                    title: "FAQs",
                    items: siteData.faqs.map((f) => ({ strong: f.q, text: f.a })),
                  },
                ]}
                defaultOpen={true}
              />
            </section>

            <!-- ✅ Trust -->
            <section style="margin:16px auto 0" aria-labelledby="trust-title">
              <h2 id="trust-title" class="sr-only">Trust</h2>

              <TestimonialsStrip
                title={siteData.testimonials.title}
                subtitle={siteData.testimonials.subtitle}
                avgScore={siteData.testimonials.avgScore}
                avgText={siteData.testimonials.avgText}
                pillHref={siteData.testimonials.pillHref}
                showControls={siteData.testimonials.showControls}
                items={siteData.testimonials.items}
              />

              <div style="height:14px;"></div>

              <StatsStrip title={siteData.statsStrip.title} stats={siteData.statsStrip.stats} />
            </section>

            <!-- ✅ Visit -->
            <section aria-labelledby="visit-title" class="section section-padding" style="padding-top:22px;">
              <h2 id="visit-title" class="section-title">Visit & Contact</h2>
              <p class="section-sub">
                Address: {siteData.brand.streetAddress}, {siteData.brand.addressLocality}, {siteData.brand.addressRegion} {siteData.brand.postalCode}.<br />
                Hours: {siteData.brand.hours?.label}.
              </p>

              <div class="mapbox" role="group" aria-label="Google map">
                <iframe
                  src={siteData.brand.mapEmbedUrl}
                  width="600"
                  height="450"
                  style="border:0;"
                  loading="lazy"
                  referrerpolicy="no-referrer-when-downgrade"
                  allowfullscreen
                  title={`${siteData.brand.name} location map`}
                ></iframe>
              </div>
            </section>

            <!-- ✅ CTA -->
            <section aria-labelledby="contact-title">
              <h2 id="contact-title" class="sr-only">Contact</h2>
              <FooterCtaBar
                title={siteData.footerCtas.title}
                subtitle={siteData.footerCtas.subtitle}
                whatsappNumber={siteData.brand.whatsappE164}
                whatsappText={siteData.brand.whatsappPrefill}
                callNumber={siteData.brand.phoneE164}
                callLabel={siteData.footerCtas.callLabel}
                brandName={siteData.footerCtas.brandName}
                logoText={siteData.footerCtas.logoText}
                copyright={siteData.footerCtas.copyright}
              />
            </section>
          </main>
        </div>

        <!-- =========================
             MOBILE UI
        ========================== -->
        <div class="ui-mobile">
          <header>
            <MobileHero
              brand={{
                name: siteData.brand.name,
                tagline: siteData.brand.tagline,
                subtitle: siteData.pageFlow.heroP,
                phone: siteData.brand.phone,
                areaChips: []//siteData.brand.areaChips,
              }}
            />
          </header>

          <main>
            <!-- ✅ Same sequence as desktop -->

            <section class="section section-padding" aria-labelledby="m-who-title">
              <h2 id="m-who-title" class="section-title">{siteData.primaryIndustries.title}</h2>
              <p class="section-sub">{siteData.primaryIndustries.subtitle}</p>

              <div class="grid grid-1">
                {siteData.primaryIndustries.items.map((it) => (
                  <article class="card" aria-label={it.title}>
                    <h3 class="card-title">{it.title}</h3>
                    <p class="card-desc">{it.desc}</p>
                  </article>
                ))}
              </div>
            </section>

            <section class="section section-padding" aria-labelledby="m-risk-title">
              <h2 id="m-risk-title" class="section-title">{siteData.localRiskContext.title}</h2>
              <p class="section-sub">{siteData.localRiskContext.subtitle}</p>
              <ul class="bullets">
                {siteData.localRiskContext.points.map((p) => <li>{p}</li>)}
              </ul>
            </section>

            <section class="section section-padding" aria-labelledby="m-claimsxp-title">
              <h2 id="m-claimsxp-title" class="section-title">{siteData.claimExperience.title}</h2>
              <p class="section-sub">{siteData.claimExperience.subtitle}</p>
              <ul class="bullets">
                {siteData.claimExperience.points.map((p) => <li>{p}</li>)}
              </ul>
            </section>

            <section aria-labelledby="m-core-services-title">
              <h2 id="m-core-services-title" class="sr-only">Core services</h2>
              <MobileCoreServices services={siteData.coreServices} />
            </section>

            <section class="section" aria-labelledby="m-authority-title">
              <h2 id="m-authority-title" class="sr-only">Industry-focused guidance</h2>
              <BlogSection
                title={siteData.commercialAuthorityPosts.title}
                subtitle={siteData.commercialAuthorityPosts.subtitle}
                viewAllHref={siteData.commercialAuthorityPosts.viewAllHref}
                viewMoreHref={siteData.commercialAuthorityPosts.viewMoreHref}
                categories={siteData.commercialAuthorityPosts.categories}
              />
            </section>

            <!-- <section class="section section-padding"> -->
              <CoverageIndexSection data={siteData.coverageIndex} />
            <!-- </section> -->

            <section class="section" aria-labelledby="m-proof-title">
              <h2 id="m-proof-title" class="sr-only">Proof & experience</h2>
              <BlogSection
                title={siteData.proofExperiencePosts.title}
                subtitle={siteData.proofExperiencePosts.subtitle}
                viewAllHref={siteData.proofExperiencePosts.viewAllHref}
                viewMoreHref={siteData.proofExperiencePosts.viewMoreHref}
                items={siteData.proofExperiencePosts.items}
                showSaveButton={false}
              />
            </section>

            <section class="section" aria-labelledby="m-renew-title">
              <h2 id="m-renew-title" class="sr-only">Renewal support</h2>
              <BlogSection
                title={siteData.renewalLicPosts.title}
                subtitle={siteData.renewalLicPosts.subtitle}
                viewAllHref={siteData.renewalLicPosts.viewAllHref}
                viewMoreHref={siteData.renewalLicPosts.viewMoreHref}
                items={siteData.renewalLicPosts.items}
                showSaveButton={false}
              />
            </section>

            <section class="section" aria-labelledby="m-insights-title">
              <h2 id="m-insights-title" class="sr-only">Insights</h2>
              <BlogSection
                title={siteData.insights.title}
                subtitle={siteData.insights.subtitle}
                viewAllHref={siteData.insights.viewAllHref}
                viewMoreHref={siteData.insights.viewMoreHref}
                items={siteData.insights.items}
                showSaveButton={false}
              />
            </section>

            <section class="section section-padding" aria-labelledby="m-help-title">
              <h2 id="m-help-title" class="sr-only">How we help</h2>
              <MobileAccordion
                sections={[
                  ...siteData.howWeHelp,
                  {
                    title: "FAQs",
                    items: siteData.faqs.map((f) => ({ strong: f.q, text: f.a })),
                  },
                ]}
                defaultOpen={true}
              />
            </section>

            <section style="margin:16px auto 0" aria-labelledby="m-trust-title">
              <h2 id="m-trust-title" class="sr-only">Trust</h2>

              <TestimonialsStrip
                title={siteData.testimonials.title}
                subtitle={siteData.testimonials.subtitle}
                avgScore={siteData.testimonials.avgScore}
                avgText={siteData.testimonials.avgText}
                pillHref={siteData.testimonials.pillHref}
                showControls={siteData.testimonials.showControls}
                items={siteData.testimonials.items}
              />

              <div style="height:14px;"></div>

              <StatsStrip title={siteData.statsStrip.title} stats={siteData.statsStrip.stats} />
            </section>

            <section aria-labelledby="m-visit-title" class="section section-padding" style="padding-top: 22px;">
              <h2 id="m-visit-title" class="section-title">Visit & Contact</h2>
              <p class="section-sub">
                Address: {siteData.brand.streetAddress}, {siteData.brand.addressLocality}, {siteData.brand.addressRegion} {siteData.brand.postalCode}.<br />
                Hours: {siteData.brand.hours?.label}.
              </p>

              <div class="mapbox" role="group" aria-label="Google map">
                <iframe
                  src={siteData.brand.mapEmbedUrl}
                  width="600"
                  height="450"
                  style="border:0;"
                  loading="lazy"
                  referrerpolicy="no-referrer-when-downgrade"
                  allowfullscreen
                  title={`${siteData.brand.name} location map`}
                ></iframe>
              </div>
            </section>

            <section aria-labelledby="m-contact-title">
              <h2 id="m-contact-title" class="sr-only">Contact</h2>

              <FooterCtaBar
                title={siteData.footerCtas.title}
                subtitle={siteData.footerCtas.subtitle}
                whatsappNumber={siteData.brand.whatsappE164}
                whatsappText={siteData.brand.whatsappPrefill}
                callNumber={siteData.brand.phoneE164}
                callLabel={siteData.footerCtas.callLabel}
                brandName={siteData.footerCtas.brandName}
                logoText={siteData.footerCtas.logoText}
                copyright={siteData.footerCtas.copyright}
              />
            </section>

            <!-- Optional sticky CTA (if you want later) -->
            <!--
            <nav class="mobile-sticky-cta" aria-label="Quick contact">
              <a class="cta" href={telHref}>{siteData.pageFlow.primaryCtaLabel}</a>
              <a class="cta cta-ghost" href={waHref} target="_blank" rel="noopener">WhatsApp</a>
            </nav>
            -->
          </main>
        </div>
      </div>
    </main>
    <FloatingContactCta brand={siteData.brand} />
  </body>
</html>
